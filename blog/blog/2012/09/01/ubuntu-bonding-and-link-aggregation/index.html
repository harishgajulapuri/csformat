
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ubuntu Bonding and link aggregation - Codingarena</title>
  <meta name="author" content="Manu S Ajith">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content=" Blog post on link aggregation in ubuntu ">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://manusajith.github.io/blog/2012/09/01/ubuntu-bonding-and-link-aggregation/">
  <link href="/blog/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Codingarena" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="Codingarena" />
  <meta name="og:title" content="Ubuntu Bonding and link aggregation" />
  <meta name="og:description" content=" Blog post on link aggregation in ubuntu " />
  <meta name="og:url" content="http://manusajith.github.io/blog/2012/09/01/ubuntu-bonding-and-link-aggregation/"/>
  <meta name="url" content="http://manusajith.github.io/blog/2012/09/01/ubuntu-bonding-and-link-aggregation/">
  
  <meta name="subject" content=""/>
  <meta name="category" content=""/>
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30559513-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/blog/">Codingarena</a>
    <ul class="nav">
      <li><a href="/blog/">Home</a></li>
      <li><a href="/blog/blog/archives">Archives</a></li>
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:manusajith.github.io" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
  <div class="wrapper_single">
    <div class="container">
      <article class="span8 offset2" role="article">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title">Ubuntu Bonding and Link Aggregation</h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <a href="https://plus.google.com/110007023591027468321?rel=author"><span class="fn">Manu S Ajith</span></a></span>
  

 - 
        








  


<time datetime="2012-09-01T00:00:00+05:30" pubdate data-updated="true"></time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>Blog post on link aggregation in ubuntu</p>

<!--more-->


<h2>Installation</h2>

<p>ifenslave is used to attach and detach slave network interfaces to a bonding device.</p>

<pre><code>sudo apt-get install ifenslave
</code></pre>

<h2>Interface Configuration</h2>

<p>Edit your interfaces configuration:</p>

<pre><code> sudo vi /etc/network/interfaces
</code></pre>

<p>For example, to combine eth0 and eth1 as slaves to your bonding interface:</p>

<pre><code>   auto eth0
   iface eth0 inet manual
   bond-master bond0

   auto eth1
   iface eth1 inet manual
   bond-master bond0

   auto bond0
   iface bond0 inet static
   address 192.168.1.10
   gateway 192.168.1.1
   netmask 255.255.255.0
   bond-mode 802.3ad
   bond-miimon 100
   bond-lacp-rate 1
   bond-slaves none
</code></pre>

<h2>Checking the bonding interface</h2>

<p>Link information is available under     /proc/net/bonding/.
To check bond0 for example:</p>

<pre><code>cat /proc/net/bonding/bond0
Ethernet Channel Bonding Driver: v3.5.0 (November 4, 2008)

Bonding Mode: IEEE 802.3ad Dynamic link aggregation
Transmit Hash Policy: layer2 (0)
MII Status: up
MII Polling Interval (ms): 100
Up Delay (ms): 0
Down Delay (ms): 0

802.3ad info
LACP rate: fast
Aggregator selection policy (ad_select): stable
bond bond0 has no active aggregator

Slave Interface: eth1
MII Status: up
Link Failure Count: 0
Permanent HW addr: 00:0c:29:f5:b7:11
Aggregator ID: N/A

Slave Interface: eth2
MII Status: up
Link Failure Count: 0
Permanent HW addr: 00:0c:29:f5:b7:1b
Aggregator ID: N/A
</code></pre>

<h2>Bringing up/down Bounded interface</h2>

<p>To bring the bounded interface, run</p>

<pre><code>ifup bond0
</code></pre>

<p>To bring down a bounded interface, run</p>

<pre><code>ifdown bond0
</code></pre>

<h2>Ethernet Bonding modes</h2>

<p>Ethernet bonding has different modes you can use. You specify the mode for your bonding interface in /etc/network/interfaces. For example:</p>

<pre><code>bond-mode active-backup
</code></pre>

<p>Descriptions of bonding modes</p>

<pre><code>Mode 0
balance-rr
</code></pre>

<p>Round-robin policy: Transmit packets in sequential order from the first available slave through the last. This mode provides load balancing and fault tolerance.</p>

<p>Mode 1
active-backup</p>

<p>Active-backup policy: Only one slave in the bond is active. A different slave becomes active if, and only if, the active slave fails. The bond&rsquo;s MAC address is externally visible on only one port (network adapter) to avoid confusing the switch. This mode provides fault tolerance. The primary option affects the behavior of this mode.</p>

<p>Mode 2
balance-xor</p>

<p>XOR policy: Transmit based on [(source MAC address XOR&rsquo;d with destination MAC address) modulo slave count]. This selects the same slave for each destination MAC address. This mode provides load balancing and fault tolerance.</p>

<p>Mode 3
broadcast</p>

<p>Broadcast policy: transmits everything on all slave interfaces. This mode provides fault tolerance.</p>

<p>Mode 4
802.3ad</p>

<p>IEEE 802.3ad Dynamic link aggregation. Creates aggregation groups that share the same speed and duplex settings. Utilizes all slaves in the active aggregator according to the 802.3ad specification.</p>

<h2>Prerequisites:</h2>

<p>Ethtool support in the base drivers for retrieving the speed and duplex of each slave.
A switch that supports IEEE 802.3ad Dynamic link aggregation. Most switches will require some type of configuration to enable 802.3ad mode.
Mode 5
balance-tlb</p>

<p>Adaptive transmit load balancing: channel bonding that does not require any special switch support. The outgoing traffic is distributed according to the current load (computed relative to the speed) on each slave. Incoming traffic is received by the current slave. If the receiving slave fails, another slave takes over the MAC address of the failed receiving slave.</p>

<h2>Prerequisites:</h2>

<p>Ethtool support in the base drivers for retrieving the speed of each slave.
Mode 6
balance-alb</p>

<p>Adaptive load balancing: includes balance-tlb plus receive load balancing (rlb) for IPV4 traffic, and does not require any special switch support. The receive load balancing is achieved by ARP negotiation. The bonding driver intercepts the ARP Replies sent by the local system on their way out and overwrites the source hardware address with the unique hardware address of one of the slaves in the bond such that different peers use different hardware addresses for the server.</p>

<p><a href="http://facebook.com/manusajith">Manu</a></p>

<p><a href="http://www.codingarena.in">www.codingarena.in</a></p>

<p><a href="http://twitter.com/manusajith" title="Twitter">@manusajith</a> | <a href="http://github.com/manusajith" title="Github">@github</a></p>
</div>


  <footer>
    <p class="meta">
      
  


  
    <span class="byline author vcard">by <a href="https://plus.google.com/110007023591027468321?rel=author"><span class="fn">Manu S Ajith</span></a></span>
  

 - 
      








  


<time datetime="2012-09-01T00:00:00+05:30" pubdate data-updated="true"></time> - 
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://manusajith.github.io/blog/2012/09/01/ubuntu-bonding-and-link-aggregation/" data-via="manusajith" data-counturl="http://manusajith.github.io/blog/2012/09/01/ubuntu-bonding-and-link-aggregation/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    
      <a class="pull-left" href="/blog/2012/08/31/installing-ioncube-loader-on-whmcpanel/" title="Previous Post: Installing ioncube loader on WHM/cPanel">&laquo; Installing ioncube loader on WHM/cPanel</a>
    
    
      <a class="pull-right" href="/blog/2012/09/12/reset-root-password-in-xampp/" title="Next Post: Reset root password in XAMPP">Reset root password in XAMPP &raquo;</a>
    
  </footer>

</div>

        
      </article>
    </div>
  </div>
  <div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/blog/blog/2013/11/22/mathjax-rails/">mathjax-rails</a>
        </li>
      
        <li>
          <a href="/blog/blog/2013/06/27/use-specific-version-of-rails-before-creating-a-new-app/">Use Specific version of rails before creating  a new app</a>
        </li>
      
        <li>
          <a href="/blog/blog/2013/04/08/pdf-generation-in-rails-with-wicked_pdf/">PDF generation in Rails</a>
        </li>
      
        <li>
          <a href="/blog/blog/2012/11/22/google-code-jam/">Google Code Jam</a>
        </li>
      
        <li>
          <a href="/blog/blog/2012/10/30/154-server-monotoring-script/">Simple Server monitoring Shell Script</a>
        </li>
      
    </ul>
    <h2><a href="/blog/archives">archives</a></h2>
  </div>
  <div class="span3">
    

  </div>
  <div class="span4">
    
<h2>twitter</h2>
<a href="https://twitter.com/manusajith" class="twitter-follow-button" data-show-count="true" data-lang="en">Follow @manusajith</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="tweet" data-twitter-user="manusajith">
</div>


  </div>
  <div class="span2">
    <h2>found on</h2>

<a href="https://github.com/manusajith/" rel="tooltip" title="Github"><img class="social_icon" title="Github" alt="github icon" src="/blog/images/glyphicons_381_github.png"></a>







<a href="http://twitter.com/manusajith" rel="tooltip" title="Twitter"><img class="social_icon" title="Twitter" alt="Twitter icon" src="/blog/images/glyphicons_391_twitter_t.png"></a>



<a href="https://plus.google.com/110007023591027468321?rel=author" rel="tooltip" title="Google Plus"><img class="social_icon" title="Google Plus" alt="Google Plus icon" src="/blog/images/glyphicons_386_google_plus.png"></a>





<h2>contact at</h2>
<a href="mailto:neo@codingarena.in">neo@codingarena.in</a>


  </div>
</div>

  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="/blog/">Codingarena</a>
  - Copyright &copy; 2013 - Manu S Ajith
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/blog/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/blog/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/blog/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/blog/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/blog/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/blog/javascripts/custom.js" type="text/javascript"></script>


<script type="text/javascript">
      var disqus_shortname = 'codingarenablog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
